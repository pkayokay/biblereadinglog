<div class="mb-4">
  <%= render(HeadingComponent.new(title: "Settings")) %>
</div>
<div data-controller="reminder-form">
  <div class="max-w-md">
    <%= form_with model: @reading_log do |form| %>
      <%= render(FormErrorsComponent.new(errors: @errors)) %>

      <%= render(FieldContainerComponent.new(custom_classes: "md:!mb-0 flex-1 w-full md:w-auto")) do %>
        <%= render(LabelComponent.new(for_attribute: "name", title: "What do you want to call this reading log?", form: form)) %>
        <%= render(InputComponent.new(type: "text", form: form, id_and_name: "name", required: true, custom_classes: "")) %>
      <% end %>
      <p class="mt-5 font-semibold text-2xl mb-3">Reminders</p>
      <%= render(FieldContainerComponent.new(custom_classes: "flex items-center")) do %>
        <%= form.check_box :is_reminder_enabled, class: "cursor-pointer w-5 h-5 rounded", data: { action: "change->reminder-form#toggleIsReminderEnabled"} %>
        <%= render(LabelComponent.new(for_attribute: "is_reminder_enabled", title: "Enable email notifications", form: form, custom_classes: "cursor-pointer ml-3 !text-base" )) %>
      <% end %>

      <div data-reminder-form-target="reminderSection" class="<%= 'hidden' if !@reading_log.is_reminder_enabled %>">
        <%= render(FieldContainerComponent.new) do %>
          <%= render(LabelComponent.new(for_attribute: "reminder_frequency", title: "How often do you want to be reminder?", form: form)) %>
          <%= form.select :reminder_frequency,ReadingLog.reminder_frequencies.keys.filter_map {|a| [a.capitalize, a]}, {}, { class: "form-select", data: { action: "change->reminder-form#updateDaysSelectField",  reminder_form_target: "frequency" } }%>
        <% end %>

        <% day_options = Date::DAYNAMES.map { |day| [day, day.downcase] }%>

        <%= render(FieldContainerComponent.new) do %>
          <%= form.label :reminder_days, 'Days', { data: { reminder_form_target: "selectLabel" }, class: "opacity-80 block font-medium text-sm"} %>
          <div data-reminder-form-target="reminderDaysButtons" class="hidden container--day__select">
            <% day_options.map {|day| {
                option: day.last,
                text: day.first,
                selected: @reading_log.reminder_days.include?(day.last)
              }}.each do |day| %>
              <button
                type="button"
                class="day__card <%= day[:selected] ? 'day__card--selected' : '' %>"
                data-option="<%= day[:option] %>"
                data-action="reminder-form#setReminderDayOption">
                <%= day[:text] %>
              </button>
            <% end %>
          </div>
          <%= form.select :reminder_days, day_options, {}, { data: { reminder_form_target: "selectField" }, multiple: true, class: 'hidden form-select' } %>
        <% end %>

        <%= render(FieldContainerComponent.new) do %>
          <%= render(LabelComponent.new(for_attribute: "reminder_time", title: "How often do you want to be reminder?", form: form)) %>
          <%= form.select :reminder_time, time_options_for_select, { selected: @reading_log.reminder_time}, { class: 'form-select' } %>
        <% end %>
      </div>
    <%= form.submit "Save changes", class: "btn btn--primary md:w-auto", data: { turbo_submits_with: "Saving..."} %>
  </div>
  <div class="border-t mt-8 pt-8">
    <p class="font-semibold text-2xl">Delete Reading Log</p>
    <p class="opacity-80 mt-2 mb-5">This will permanently delete the reading log.</p>
    <%= button_to "Delete Reading Log", reading_log_path, method: :delete, data: { turbo_confirm: "Are you sure you want to delete this?"},class: "btn w-auto" %>
  </div>
<% end %>
